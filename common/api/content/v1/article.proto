syntax = "proto3";

package common.api.content.v1;

import "google/api/annotations.proto";
import "validate/validate.proto";
import "google/protobuf/timestamp.proto";
import "common/v1/common.proto";
import "user/v1/user.proto";

option go_package = "common/api/content/v1;v1";

message Article {
  int64 id = 1;                        // 唯一ID
  int64 user_id = 2;                   // 作者ID
  string title = 3;                    // 标题
  string content = 4;                  // 正文内容

  bool has_postscript = 5;             // 是否有附言
  string reward_content = 6;           // 打赏区内容（可为空）
  int32 reward_points = 7;             // 打赏积分

  int32 status = 8;                    // 状态: 0-正常 1-隐藏 2-锁定 3-草稿 4-删除
  int32 type = 9;                      // 类型: 0-普通 1-问答 2-投票 3-抽奖
  bool commentable = 10;               // 是否允许评论
  bool anonymous = 11;                 // 是否匿名

  int32 thank_count = 12;              // 感谢数
  int32 like_count = 13;               // 点赞数
  int32 collect_count = 14;            // 收藏数
  int32 watch_count = 15;              // 关注数
  int32 reply_count = 16;              // 回复数

  int32 bounty_points = 17;            // 悬赏积分
  int64 accepted_answer_id = 18;       // 采纳评论ID（可为空）

  int32 vote_total = 19;               // 总投票数
  int32 lottery_participant_count = 20;// 抽奖参与人数
  int32 lottery_winner_count = 21;     // 抽奖获奖人数

  google.protobuf.Timestamp created_at = 22; // 创建时间
  google.protobuf.Timestamp updated_at = 23; // 更新时间

  user.v1.User author_user = 24; // 作者信息
  user.v1.User reply_user = 25; // 最后回复用户
  google.protobuf.Timestamp replied_at = 26; // 最后回复时间
}

// Article 服务
service ContentArticleService {

  // 新增文章
  rpc Add (AddArticleRequest) returns (AddArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/add"
      body: "*"
    };
  }

  // 发布文章（从草稿发布）
  rpc Publish (PublishArticleRequest) returns (PublishArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/publish"
      body: "*"
    };
  }

  // 修改文章（管理员使用）
  rpc Update (UpdateArticleRequest) returns (UpdateArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/update"
      body: "*"
    };
  }

  // 删除文章（仅草稿）
  rpc Delete (DeleteArticleRequest) returns (DeleteArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/delete"
      body: "*"
    };
  }

  // 查询文章
  rpc Get (GetArticleRequest) returns (GetArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/get"
      body: "*"
    };
  }


  // 查询单篇文章
  rpc GetOne (GetArticleOneRequest) returns (GetArticleOneReply) {
    option (google.api.http) = {
      post: "/v1/article/getOne"
      body: "*"
    };
  }



  // 添加附言
  rpc AddPostscript (AddPostscriptArticleRequest) returns (AddPostscriptArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/addPostscript"
      body: "*"
    };
  }

  // 打赏文章
  rpc Reward (RewardArticleRequest) returns (RewardArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/reward"
      body: "*"
    };
  }

  // 感谢文章
  rpc Thank (ThankArticleRequest) returns (ThankArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/thank"
      body: "*"
    };
  }

  // 点赞文章
  rpc Like (LikeArticleRequest) returns (LikeArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/like"
      body: "*"
    };
  }

  // 收藏文章
  rpc Collect (CollectArticleRequest) returns (CollectArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/collect"
      body: "*"
    };
  }

  // 关注文章
  rpc Watch (WatchArticleRequest) returns (WatchArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/watch"
      body: "*"
    };
  }

  // 采纳评论
  rpc AcceptAnswer (AcceptAnswerArticleRequest) returns (AcceptAnswerArticleReply) {
    option (google.api.http) = {
      post: "/v1/article/acceptAnswer"
      body: "*"
    };
  }

}


message AddArticleRequest {
  // 标题
  string title = 1 [(validate.rules).string = {min_len: 1, max_len: 100}];
  // 内容
  string content = 2 [(validate.rules).string = {min_len: 1}];
  // 打赏内容
  string reward_content = 3;
  // 打赏积分
  int32 reward_points = 4 [(validate.rules).int32 = {gte: 0}];
  // 状态 0-正常 1-隐藏 2-锁定 3-草稿 4-删除
  int32 status = 5;
  // 类型 0-普通 1-问答 2-投票 3-抽奖
  int32 type = 6;
  // 悬赏积分
  int32 bounty_points = 7 [(validate.rules).int32 = {gte: 0}];
}
message AddArticleReply {}

message PublishArticleRequest {
  // 文章ID
  int64 article_id = 1;
}
message PublishArticleReply {}

message UpdateArticleRequest {
  // 文章ID
  int64 article_id = 1;
  // 状态 0-正常 1-隐藏 2-锁定 3-草稿 4-删除
  int32 status = 2;
  // 是否允许评论
  bool commentable = 3;
  // 是否匿名
  bool anonymous = 4;
}
message UpdateArticleReply {}

message DeleteArticleRequest {
  // 文章ID
  int64 article_id = 1;
}
message DeleteArticleReply {}

message GetArticleRequest {
  // 分页
  common.v1.PageRequest page = 1;
  // 标签
  optional int64 tagId = 2;
  // 领域
  optional int64 domainId = 3;
  // 状态 0-正常 3-草稿
  optional int32 status = 4;
  // 类型 0-普通 1-问答 2-投票 3-抽奖
  optional int32 type = 5;
}
message GetArticleReply {
  // 分页信息
  common.v1.PageReply page = 2;
  // 文章列表
  repeated Article articles = 1;
}

message GetArticleOneRequest {
  // 文章ID
  int64 article_id = 1;
}
message GetArticleOneReply {
  // 文章
  Article article = 1;
  // 作者
  user.v1.User user = 2;
}

message AddPostscriptArticleRequest {
  // 文章ID
  int64 article_id = 1;
  // 内容
  string content = 2 [(validate.rules).string = {min_len: 1}];
}
message AddPostscriptArticleReply {}

message RewardArticleRequest {
  // 文章ID
  int64 article_id = 1;
}
message RewardArticleReply {}

message ThankArticleRequest {
  // 文章ID
  int64 article_id = 1;
  // 是否感谢
  bool active = 2;
}
message ThankArticleReply {}

message LikeArticleRequest {
  // 文章ID
  int64 article_id = 1;
  // 是否点赞
  bool active = 2;
}
message LikeArticleReply {}

message CollectArticleRequest {
  // 文章ID
  int64 article_id = 1;
  // 是否收藏
  bool active = 2;
}
message CollectArticleReply {}

message WatchArticleRequest {
  // 文章ID
  int64 article_id = 1;
  // 是否关注
  bool active = 2;
}
message WatchArticleReply {}

message AcceptAnswerArticleRequest {
  // 文章ID
  int64 article_id = 1;
  // 评论ID
  int64 comment_id = 2;
}
message AcceptAnswerArticleReply {}

message UpdateStatusArticleRequest {}
message UpdateStatusArticleReply {}


// 文章事件模型

message ArticleEventPublish {
  int64 article_id = 1;
  int64 user_id = 2;
  string title = 3;
  string content = 4;
  string reward_content = 5;
  int32 reward_points = 6;
  int32 status = 7;
  int32 type = 8;
  int32 bounty_points = 9;
}
